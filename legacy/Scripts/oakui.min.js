var useCookies=!1,ISA_RISCV=0,ISA_MIPS=1,settings={theme:0,defaultISA:ISA_RISCV,hotkeyNewTab:"a_78",hotkeySave:"a_83",hotkeyOpen:"a_79",hotkeyAssemble:"_119",hotkeySimulate:"_120",hotkeyStepbystep:"_121"};function Tab(_name,_content,_machinecode){return{name:_name,content:_content,machinecode:_machinecode,console:"",instructionLog:"",instructionSet:ISA_RISCV,memorySize:4096,core:null,inSimulation:!1,registers:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],regStates:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}}var editor,mcEditor,tabs=[],currentTab=-1,CONSOLE_ERROR=0,CONSOLE_SUCCESS=1,CONSOLE_WARNING=2,CONSOLE_NORMAL=3,REGISTER_UNASSIGNED=0,REGISTER_ASSIGNED=1,REGISTER_NEWASSIGNED=2;function resizeMC(){}function resizeRAM(){}function resize(){resizeMC(),resizeRAM()}var startSim,keyCodeNames={0:"That key has no keycode",3:"break",8:"backspace / delete",9:"tab",12:"clear",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause/break",20:"caps lock",21:"hangul",25:"hanja",27:"escape",28:"conversion",29:"non-conversion",32:"spacebar",33:"page up",34:"page down",35:"end",36:"home",37:"left arrow",38:"up arrow",39:"right arrow",40:"down arrow",41:"select",42:"print",43:"execute",44:"Print Screen",45:"insert",46:"delete",47:"help",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",58:":",59:"semicolon (firefox), equals",60:"<",61:"equals (firefox)",63:"ß",64:"@ (firefox)",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"Windows Key / Left ⌘ / Chromebook Search key",92:"right window key",93:"Windows Menu / Right ⌘",95:"sleep",96:"numpad 0",97:"numpad 1",98:"numpad 2",99:"numpad 3",100:"numpad 4",101:"numpad 5",102:"numpad 6",103:"numpad 7",104:"numpad 8",105:"numpad 9",106:"multiply",107:"add",108:"numpad period (firefox)",109:"subtract",110:"decimal point",111:"divide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",124:"f13",125:"f14",126:"f15",127:"f16",128:"f17",129:"f18",130:"f19",131:"f20",132:"f21",133:"f22",134:"f23",135:"f24",144:"num lock",145:"scroll lock",160:"^",161:"!",163:"#",164:"$",165:"ù",166:"page backward",167:"page forward",168:"refresh",169:"closing paren (AZERTY)",170:"*",171:"~ + * key",172:"home key",173:"minus (firefox), mute/unmute",174:"decrease volume level",175:"increase volume level",176:"next",177:"previous",178:"stop",179:"play/pause",180:"e-mail",181:"mute/unmute (firefox)",182:"decrease volume level (firefox)",183:"increase volume level (firefox)",186:"semi-colon / ñ",187:"equal sign",188:"comma",189:"dash",190:"period",191:"forward slash / ç",192:"grave accent / ñ / æ / ö",193:"?, / or °",194:"numpad period (chrome)",219:"open bracket",220:"back slash",221:"close bracket / å",222:"single quote / ø / ä",223:"`",224:"left or right ⌘ key (firefox)",225:"altgr",226:"< /git >, left back slash",230:"GNOME Compose Key",231:"ç",233:"XF86Forward",234:"XF86Back",240:"alphanumeric",242:"hiragana/katakana",243:"half-width/full-width",244:"kanji",255:"toggle touchpad"};function getKeyNameFromStr(k){return keyCodeNames[k]}function setMachineCodeState(state){state?($("section > #editor").css({width:"50%"}),$("section > aside").css({width:"50%"})):($("section > #editor").css({width:"100%"}),$("section > aside").css({width:"0%"}))}function addConsoleMsg(msg,type){var typeStr="";type==CONSOLE_ERROR?typeStr=" class='error'":type==CONSOLE_SUCCESS?typeStr=" class='success'":type==CONSOLE_WARNING&&(typeStr=" class='warning'"),$("#console").append("<span"+typeStr+">"+msg+"</span>")}function daysToMs(ex){return 24*ex*60*60*1e3}function setCookie(cname,cvalue,ex){var d=new Date;d.setTime(d.getTime()+ex);var expires="expires="+d.toUTCString();document.cookie=cname+"="+cvalue+";"+expires+";path=/"}function getCookie(cname){for(var name=cname+"=",ca=decodeURIComponent(document.cookie).split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(name))return c.substring(name.length,c.length)}return""}function setSettingsCookie(){if(useCookies)for(var key in settings)settings.hasOwnProperty(key)&&setCookie(key,settings[key],daysToMs(120))}function getCookies(){for(var key in useCookies=!1,settings){var c=getCookie(key);""!=c&&(settings[key]=c,useCookies=!0)}}function enableCookies(){useCookies=!0,setSettingsCookie(),$("#toggleCookies").html("Remove Cookies"),$(".cookie").fadeOut(200)}function disableCookies(){$("#toggleCookies").html("Use Cookies"),$(".cookie").fadeOut(200)}function sanitizeHTML(s){return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}function uiAssemble(){if(""!=(val=editor.getValue())){var core=tabs[currentTab].core;resetCore(core);var val=editor.getValue(),output=assemble(core,val);$("#console").html(""),null==output.errorMessage?($("#machineCode").val(output.machineCode.Oak_hex()),addConsoleMsg("<b>Assembly Succeeded!</b",CONSOLE_SUCCESS)):addConsoleMsg("<b>Assembler Error: </b>"+sanitizeHTML(output.errorMessage),CONSOLE_ERROR),tabs[currentTab].inSimulation=!1}}function editorHasCode(){return 0<editor.getValue().replace(/\s/g,"").length}function editorChange(){editorHasCode()?($("#playbutton img").attr("src","Images/assemblePlay.png"),$("#playbutton span").html("Assemble and Simulate")):($("#playbutton img").attr("src","Images/play.png"),$("#playbutton span").html("Simulate"))}function prepareSim(){var core=tabs[currentTab].core;0<$("#console").html().length&&($("#console").html(""),$("#log").html("")),resetCore(core);for(var bytes=[],hex=$("#machineCode").val().split(" "),i=0;i<hex.length;i++){var byte=parseInt(hex[i],16);isNaN(byte)||bytes.push(byte)}if(0!=bytes.length){if(!(tabs[currentTab].memorySize<=bytes.length)){for(i=0;i<32;i++)tabs[currentTab].regStates[i]=REGISTER_UNASSIGNED;return startSim=performance.now(),bytes}addConsoleMsg("<b>ERROR: </b>The allocated memory size is not big enough to contain the program. It needs to be at least "+bytes.length+" bytes.",CONSOLE_ERROR)}else addConsoleMsg("<b>ERROR: </b>No valid machine code.",CONSOLE_ERROR)}function uiStepbystep(){var core=tabs[currentTab].core;if(0==tabs[currentTab].inSimulation){var bytes=prepareSim(),load=loadIntoMemory(core,bytes);if(null!==load)return void addConsoleMsg("<b>Failed to load machine code into memory: </b>"+load,CONSOLE_ERROR);tabs[currentTab].inSimulation=!0}var output=simulateStep(core);"@Oak_Ecall"!=output?(addConsoleMsg("<b>Simulator Step: </b>"+$("#log > span:last-child").html(),CONSOLE_NORMAL),updateRegAndMemory()):null!=output&&"@Oak_Ecall"!=output&&(updateRegAndMemory(),addConsoleMsg("<b>Simulator Error: </b>"+output,CONSOLE_ERROR))}function displayMemory(){var core=tabs[currentTab].core,memory=getMemory(core);$("#memory").html("");for(var i=0;i<memory.length;i++){var memOut=memory[i];$("#memory").append("0x"+padNo(memOut.toString(16),2)+" ")}}function updateRegAndMemory(){var core=tabs[currentTab].core,t0=performance.now();console.log("Updating memory/registers...");for(var modReg=core.registerFile.getModifiedRegisters(),i=0;i<32;i++)tabs[currentTab].registers[i]=registerRead(core,i),modReg[i]?tabs[currentTab].regStates[i]=REGISTER_NEWASSIGNED:tabs[currentTab].regStates[i]==REGISTER_NEWASSIGNED&&(tabs[currentTab].regStates[i]=REGISTER_ASSIGNED);displayMemory(),showRegisters();var t1=performance.now();console.log("Memory/register update done in "+(t1-t0)+"ms.")}function uiSimulate(){if(tabs[currentTab].inSimulation){tabs[currentTab].inSimulation=!1,"@Oak_Ecall"!=(output=continueSim(tabs[currentTab].core))&&null!=output&&(updateRegAndMemory(),addConsoleMsg("<b>Simulator Error: </b>"+output,CONSOLE_ERROR))}else{editorHasCode()&&uiAssemble();var output,core=tabs[currentTab].core,bytes=prepareSim();"@Oak_Ecall"!==(output=simulate(core,bytes))&&null!=output&&(updateRegAndMemory(),addConsoleMsg("<b>Simulator Error: </b>"+output,CONSOLE_ERROR))}}function switchModes(type){editor.getSession().setMode(type)}function createCore(type,size,ecallback,dcallback){switch("number"!=typeof size&&(size=parseInt(size)),type){case ISA_MIPS:return new MIPSCore(size,ecallback,dcallback);default:case ISA_RISCV:return new RISCVCore(size,ecallback,dcallback)}}function updateMemorySize(newSize){if(newSize!=tabs[currentTab].memorySize){if(newSize<=0)return void addConsoleMsg("<b>ERROR: </b> Memory size cannot be less than one byte.",CONSOLE_ERROR);tabs[currentTab].memorySize=newSize,delete tabs[currentTab].core,tabs[currentTab].core=createCore(tabs[currentTab].instructionSet,newSize,invokeEnvironmentCall,decodeCallback),updateRegAndMemory(),$("#console").html(""),addConsoleMsg("<b>Success: </b> Memory has been resized. (Please make sure the new memory size fits your program.)",CONSOLE_SUCCESS)}}function setConsoleMode(mode){0==mode?($("#memory, #log").css("display","none"),$("#console").css("display","block")):1==mode?($("#console, #log").css("display","none"),$("#memory").css("display","block")):($("#console, #memory").css("display","none"),$("#log").css("display","block")),$("#consoleSel").val(mode)}function showRegisters(){for(var mode=parseInt($("#regSel").val()),registers=tabs[currentTab].registers,rows=$("table > tbody > tr"),cells=$("table > tbody > tr > td:nth-child(2)"),i=0;i<registers.length;i++){var output;switch(mode){case 0:output="0x"+padNo((registers[i]>>>0).toString(16),8);break;case 1:output=(registers[i]>>>0).toString(10);break;case 2:2147483648<(output=registers[i].toString(10))&&(output-=4294967296);break;case 3:output="0b"+padNo((registers[i]>>>0).toString(2),32);break;case 4:output=oakParseToFloat(registers[i])}switch(cells.eq(i).html(output),tabs[currentTab].regStates[i]){default:rows.eq(i).removeClass("justEdited").removeClass("edited");break;case REGISTER_ASSIGNED:rows.eq(i).removeClass("justEdited").addClass("edited");break;case REGISTER_NEWASSIGNED:rows.eq(i).addClass("justEdited").removeClass("edited")}}}function invokeEnvironmentCall(){var core=tabs[currentTab].core,reg_type=(core=tabs[currentTab].core).defaultEcallRegType,reg_arg=core.defaultEcallRegArg,type=registerRead(core,reg_type),arg=registerRead(core,reg_arg);1==tabs[currentTab].inSimulation&&(addConsoleMsg("<b>Simulator Step: </b>"+$("#log > span:last-child").html(),CONSOLE_NORMAL),updateRegAndMemory());setConsoleMode(0);var exit=!1;switch(type){case 1:$("#console").append("<span> >>> "+arg+"</span>");break;case 4:for(var pointer=arg,output="",char=core.memory[pointer];0!=char;)output+=String.fromCharCode(char),pointer+=1,char=core.memory[pointer];console.log(output),$("#console").append("<span> >>> "+output+"</span>");break;case 5:updateRegAndMemory();var input=prompt("Please enter a number as input.");tabs[currentTab].registers[reg_type]=parseInt(input),registerWrite(core,reg_type,parseInt(input)),$("#console").append("<span class='input insertable'> <<< "+input+"</span>");break;case 8:updateRegAndMemory();input=prompt("Please enter a string as input.");for(var bytes=[],i=0;i<input.length;i++)bytes.push(255&input.charCodeAt(i));core.memset(tabs[currentTab].registers[reg_arg],bytes),$("#console").append("<span class='input insertable'> <<< "+input+"</span>");break;case 10:exit=!0;break;case 420:var link;switch(arg){default:link="https://youtube.com/watch?v=KZACorHeE-c";break;case 1:link="https://youtube.com/watch?v=L_jWHffIx5E";break;case 2:link="https://youtube.com/watch?v=dQw4w9WgXcQ";break;case 3:link="https://youtube.com/watch?v=VONRQMx78YI";break;case 4:link="https://youtube.com/watch?v=mtf7hC17IBM";break;case 5:link="https://youtube.com/watch?v=yKNxeF4KMsY"}window.open(link,"_blank").focus();break;case 1776:window.open("https://youtu.be/TOygO4n-CtQ","_blank").focus();break;case 24601:window.open("https://youtu.be/IZdjz6lLngU?t=150","_blank").focus();break;default:addConsoleMsg("<b>WARNING:</b> Environment call "+type+" unsupported.",CONSOLE_WARNING)}if(1==tabs[currentTab].inSimulation&&updateRegAndMemory(),exit){tabs[currentTab].inSimulation=!1;var time=performance.now()-startSim,numInstructions=$("#log > span").length,ips=1e3*numInstructions/time;updateRegAndMemory(),addConsoleMsg("<b>Complete:</b> Simulation completed in "+Math.round(time)+" ms, "+numInstructions+" instructions, "+Math.round(ips)+" instructions/second.",CONSOLE_SUCCESS)}else if(0==tabs[currentTab].inSimulation){"@Oak_Ecall"!=(output=continueSim(core))&&null!=output&&(updateRegAndMemory(),addConsoleMsg("<b>Simulator Error: </b>"+output,CONSOLE_ERROR))}}function decodeCallback(data){$("#log").append("<span>"+data+"</span>")}function setOptionsTab(index){for(var i=0;i<3;i++)i==index?($("aside > div").eq(i+2).addClass("selected"),$(".optionsTabs > div").eq(i).addClass("selected")):($("aside > div").eq(i+2).removeClass("selected"),$(".optionsTabs > div").eq(i).removeClass("selected"))}function padNo(str,length){for(var padded=str,i=0;i<length-str.length;i++)padded="0"+padded;return padded}function oakParseFromFloat(num){var signString=num<0?"1":"0",flParts=num.toString().split("."),wholePart=parseInt(flParts[0]),fracPart=0;isNaN(wholePart)&&(wholePart=0),1<flParts.length&&(fracPart=parseInt(flParts[1]));for(var wholeMantissa=(wholePart>>>0).toString(2),fracMantissaStr="",fracPartParsing=parseFloat("0."+fracPart.toString()),i=0;0<fracPartParsing;){var potentialAdd=Math.pow(2,-i-1);fracPartParsing-potentialAdd<0?fracMantissaStr+="0":(fracPartParsing-=potentialAdd,fracMantissaStr+="1"),i++}var exponent,finalMantissa=parseInt(wholeMantissa.substr(1)+fracMantissaStr,2).toString(2);alert(wholeMantissa),exponent=0<wholeMantissa?wholeMantissa.length:-fracMantissaStr.length,finalMantissa=parseInt(wholeMantissa.substr(1)+fracMantissaStr,2).toString(2).substring(0,23),exponent+=127;var finalStr=signString+"|"+padNo(((exponent=Math.log2(exponent))>>>0).toString(2),8)+"|"+padNo(finalMantissa,23);return alert(finalStr),parseInt(finalStr,2)}function downloadAsm(){var data=editor.getValue();if(0!=data.length){var el=document.createElement("a"),blob=new Blob([data],{type:"text/plain"}),blobLink=URL.createObjectURL(blob),name=tabs[currentTab].name+".s";el.setAttribute("href",blobLink),el.setAttribute("download",name),el.style.display="none",document.body.appendChild(el),el.click(),document.body.removeChild(el)}}function downloadBin(){var data=$("#machineCode").val();if(0!=data.length){for(var hexdata=data.split(" "),bytes=[],i=0;i<hexdata.length;i++){var v=parseInt(hexdata[i],16);isNaN(v)||bytes.push(v)}var byteArray=new Uint8Array(bytes),blob=new Blob([byteArray],{type:"application/octet-stream"}),blobLink=URL.createObjectURL(blob),element=document.createElement("a"),name=tabs[currentTab].name+".bin";element.setAttribute("href",blobLink),element.setAttribute("download",name),element.style.display="none",document.body.appendChild(element),element.click(),document.body.removeChild(element)}}function downloadRam(){var data=$("#memory").html();if(0!=data.length){for(var hexdata=data.split(" "),bytes=[],i=0;i<hexdata.length;i++){var v=parseInt(hexdata[i],16);isNaN(v)||bytes.push(v)}var byteArray=new Uint8Array(bytes),blob=new Blob([byteArray],{type:"application/octet-stream"}),blobLink=URL.createObjectURL(blob),element=document.createElement("a"),name=tabs[currentTab].name+".ram";element.setAttribute("href",blobLink),element.setAttribute("download",name),element.style.display="none",document.body.appendChild(element),element.click(),document.body.removeChild(element)}}function encodeFloat(number){var i,lastBit,rounded,j,exponent,status=(n=+number)!=n||n==-1/0||n==1/0?n:0,exp=0,bin=new Array(281),signal=(n=0!==status?0:n)<0,n=Math.abs(n),intPart=Math.floor(n),floatPart=n-intPart;if(0!==status){if(n!=n)return 2143289344;if(n===1/0)return 2139095040;if(n===-1/0)return 4286578688}for(i=281;i;)bin[--i]=0;for(i=129;intPart&&i;)bin[--i]=intPart%2,intPart=Math.floor(intPart/2);for(i=128;0<floatPart&&i;)(bin[++i]=(1<=(floatPart*=2))-0)&&--floatPart;for(i=-1;++i<281&&!bin[i];);if(bin[(lastBit=22+(i=-126<=(exp=128-i)&&exp<=127?i+1:128-(exp=-127)))+1]){if(!(rounded=bin[lastBit]))for(j=lastBit+2;!rounded&&j<281;)rounded=bin[j++];for(j=lastBit+1;rounded&&0<=--j;)(bin[j]=!bin[j]-0)&&(rounded=0)}for(i=i-2<0?-1:i-3;++i<281&&!bin[i];);for(-126<=(exp=128-i)&&exp<=127?++i:exp<-126&&(i=255,exp=-127),(intPart||0!==status)&&(exp=128,i=129,status==-1/0?signal=1:status!=status&&(bin[i]=1)),n=Math.abs(exp+127),j=exponent=0;j<8;)exponent+=n%2<<j,n>>=1,j++;var mantissa=0;for(n=i+23;i<n;i++)mantissa=(mantissa<<1)+bin[i];return(signal?2147483648:0)+(exponent<<23)+mantissa|0}function oakParseToFloat(num){var sign=1;2147483648&num&&(sign=-1);var exp=(2139095040&num)>>23;exp=Math.pow(2,exp-127);for(var mantissa=8388607&num,i=0;i<23;i++)mantissa/=2;return sign*exp*(mantissa+=1)}function converter(){var output,input=$("#inputVal").val();switch(parseInt($("#inputSel").val())){case 0:input=parseInt(input,16);break;case 1:case 2:input=parseInt(input,10);break;case 3:input=parseInt(input,2);break;case 4:input=encodeFloat(input)}switch("NaN"==input.toString()&&alert("Invalid value for input!"),parseInt($("#outputSel").val())){case 0:output="0x"+padNo((input>>>0).toString(16),8);break;case 1:output=(input>>>0).toString(10);break;case 2:2147483648<(output=input.toString(10))&&(output-=4294967296);break;case 3:output="0b"+padNo((input>>>0).toString(2),32);break;case 4:output=oakParseToFloat(input)}$("#outputVal").val(output)}function contextMenuListener(el){el.addEventListener("contextmenu",function(e){$("#contextMenu").css({left:e.pageX,top:e.pageY}).stop().slideDown(64);for(var i=0;el.parentElement.children[i]!==el;)i++;$("body").click(function(evt){$("#contextMenu").slideUp(64)}),e.preventDefault()})}var defaultTab="<div class='selected'><span></span><div></div></div>";function setRegisterNames(){for(var regNames=tabs[currentTab].core.instructionSet.abiNames,cells=$("table tr > td:first-child"),i=0;i<regNames.length;i++)cells.eq(i).html(regNames[i]);showRegisters()}function addTabOfType(type){addTabDefault("Untitled",type)}function addTabSimple(name,isa_type){0!=tabs.length&&(tabs[currentTab].content=editor.getValue(),tabs[currentTab].machinecode=mcEditor.val(),tabs[currentTab].instructionLog=$("#log").html(),tabs[currentTab].console=$("#console").html()),$("body").removeClass("noTab"),$("section nav > div").removeClass("selected"),currentTab=$("section nav > div").length,$("section nav").append(defaultTab),$("section nav > div.selected span").html(name),$("section nav > div.selected").on("click",function(){switchToTab($(this).index())}),$("section nav > div.selected > div").on("click",function(e){removeTab($(this).parent().index()),e.preventDefault()}),$("#regSel").on("change",function(){showRegisters()}),$("#filename").val(name),$("#memsize").val(4096),$("#console").html(""),$("#memory").html(""),$("#log").html(""),tabs.push(Tab(name,"","")),tabs[currentTab].instructionSet=parseInt(isa_type),tabs[currentTab].core=createCore(tabs[currentTab].instructionSet,4096,invokeEnvironmentCall,decodeCallback),$("#isa").val(tabs[currentTab].instructionSet),switchModes(tabs[currentTab].core.aceStyle),setRegisterNames()}function addTabDefault(name,isa_type){addTabSimple(name,isa_type);var core=tabs[currentTab].core;tabs[currentTab].content=core.defaultCode,tabs[currentTab].machinecode=core.defaultMachineCode,editor.setValue(core.defaultCode),mcEditor.val(core.defaultMachineCode)}function addTab(name,isa_type,code,machinecode){addTabSimple(name,isa_type),tabs[currentTab].content=code,tabs[currentTab].machinecode=machinecode,editor.setValue(code),mcEditor.val(machinecode)}function switchToTab(num){tabs[currentTab].content=editor.getValue(),tabs[currentTab].machinecode=mcEditor.val(),tabs[currentTab].console=$("#console").html(),tabs[currentTab].instructionLog=$("#log").html(),editor.setValue(tabs[num].content),mcEditor.val(tabs[num].machinecode);var tabsEl=$("section nav > div");tabsEl.eq(currentTab).removeClass("selected"),tabsEl.eq(num).addClass("selected"),$("#filename").val(tabs[num].name),$("#isa").val(tabs[num].instructionSet),$("#memsize").val(tabs[num].memorySize),$("#console").html(tabs[num].console),$("#log").html(tabs[num].instructionLog),switchModes(tabs[num].core.aceStyle),currentTab=num,displayMemory(),setRegisterNames()}function removeTab(id){if(1==tabs.length)tabs.pop(),$("section nav").html(""),$("body").addClass("noTab"),currentTab=-1;else if(tabs.splice(id,1),$("section nav > div").eq(id).remove(),id<currentTab)currentTab--;else if(currentTab==id){0!=id&&currentTab--;var tabsEl=$("section nav > div");tabsEl.removeClass("selected"),tabsEl.eq(currentTab).addClass("selected"),switchModes(tabs[currentTab].core.aceStyle),$("#filename").val(tabs[currentTab].name),$("#isa").val(tabs[currentTab].instructionSet),$("#memsize").val(tabs[currentTab].memorySize),editor.setValue(tabs[currentTab].content),mcEditor.val(tabs[currentTab].machineCode),$("#console").html(tabs[currentTab].console),$("#log").html(tabs[currentTab].instructionLog),displayMemory(),setRegisterNames()}}function removeTabThis(){removeTab(currentTab)}function addTabWindow(){$("#overlay > div > div").html("New File"),$("#overlay input").val("Untitled"),$("#overlay select").val(settings.defaultISA),$("#overlay").fadeIn(200),$("#overlayAccept").click(function(e){addTabDefault($("#overlay input").val(),$("#overlay select").val()),$("#overlay").fadeOut(200),$(this).unbind("click")}),$("#overlayCancel").click(function(e){$("#overlay").fadeOut(200),$(this).unbind("click")})}function uploadBin(e){var files=$("#fileInputElement")[0].files;if(files.length){var file=files[0],blob=file.slice(0,file.size),fr=new FileReader;fr.addEventListener("load",function(){for(var bytes=new Uint8Array(this.result),hexer="",i=0;i<bytes.length;i++)bytes[i]<16?hexer+="0"+bytes[i].toString(16).toUpperCase()+" ":hexer+=bytes[i].toString(16).toUpperCase()+" ";$("#overlay > div > div").html("Load Binary File"),$("#overlay input").val(file.name),$("#overlay select").val(settings.defaultISA),$("#overlay").fadeIn(200),$("#overlayAccept").click(function(e){addTab($("#overlay input").val(),$("#overlay select").val(),"",hexer),setMachineCodeState(!0),$("#overlay").fadeOut(200),$(this).unbind("click")}),$("#overlayCancel").click(function(e){$("#overlay").fadeOut(200),$(this).unbind("click")})}),fr.readAsArrayBuffer(blob),$("#fileInputElement").val("")}}function uploadAsm(e){var files=$("#asmInputElement")[0].files;if(files.length){var file=files[0],blob=file.slice(0,file.size),fr=new FileReader;fr.addEventListener("load",function(){var res=this.result;$("#overlay > div > div").html("Load Assembly File"),$("#overlay input").val(file.name),$("#overlay select").val(settings.defaultISA),$("#overlay").fadeIn(200),$("#overlayAccept").click(function(e){addTab($("#overlay input").val(),$("#overlay select").val(),res,""),$("#overlay").fadeOut(200),$(this).unbind("click")}),$("#overlayCancel").click(function(e){$("#overlay").fadeOut(200),$(this).unbind("click")})}),fr.readAsText(blob),$("#asmInputElement").val("")}}function addCookieToast(){$("body").prepend("<div class='toast cookie'><a href='javascript:void(0)' class='cross'></a> Hello there. Oak.js uses local cookies to store your theme. If that's okay with you, press <a href='javascript:void(0)'>here</a>. If not, press <a href='javascript:void(0)'>here</a> and we'll disable them."),$(".cookie a:first-child").click(enableCookies),$(".cookie a:nth-child(2)").click(enableCookies),$(".cookie a:nth-child(3)").click(disableCookies)}function are_cookies_enabled(){document.cookie="testcookie=valid";var cookieEnabled=-1!=document.cookie.indexOf("testcookie");return cookieEnabled&&(document.cookie="testcookie=; expires=Thu, 01 Jan 1970 00:00:00 UTC;"),cookieEnabled}function getCombinationNameFromStr(str){var keycode=str.substr(str.indexOf("_")+1),out=getKeyNameFromStr(parseInt(keycode));return-1!=str.indexOf("a")&&(out="Alt + "+out),-1!=str.indexOf("m")&&(out="Mod + "+out),out}function displaySettings(state){state?$("#settingsOverlay").fadeIn(200):$("#settingsOverlay").fadeOut(200)}function eraseCookie(name){setCookie(name,"",-1)}function toggleCookies(){if(useCookies){useCookies=!1,$("#toggleCookies").html("Use Cookies");for(var cookies=document.cookie.split(";"),i=0;i<cookies.length;i++)eraseCookie(cookies[i].split("=")[0])}else enableCookies()}$(document).ready(function(){if(are_cookies_enabled())if(getCookies(),useCookies){var themeID=parseInt(settings.theme);$("#themes").val(themeID);for(i=0;i<3;i++)$("#theme"+i).prop("disabled",themeID!=i);$("#toggleCookies").html("Remove Cookies"),$(".hotkeyCapture:eq(0)").html(getCombinationNameFromStr(settings.hotkeyNewTab)),$(".hotkeyCapture:eq(1)").html(getCombinationNameFromStr(settings.hotkeyOpen)),$(".hotkeyCapture:eq(2)").html(getCombinationNameFromStr(settings.hotkeySave)),$(".hotkeyCapture:eq(3)").html(getCombinationNameFromStr(settings.hotkeyAssemble)),$(".hotkeyCapture:eq(4)").html(getCombinationNameFromStr(settings.hotkeySimulate)),$(".hotkeyCapture:eq(5)").html(getCombinationNameFromStr(settings.hotkeyStepbystep))}else{addCookieToast(),$("#themes").val(0);for(var i=1;i<3;i++)$("#theme"+i).prop("disabled",!0)}console.log(settings),$("#defaultISA").val(parseInt(settings.defaultISA)),(editor=ace.edit("editor")).getSession().on("change",editorChange),editor.setOption("firstLineNumber",0),editor.setTheme("ace/theme/oak"),editor.getSession().setMode("ace/mode/riscv"),editor.getSession().setUseWrapMode(!0),editor.$blockScrolling=1/0,mcEditor=$("#machineCode"),addTabOfType(parseInt(settings.defaultISA)),$(".addTabOfType").on("click",function(){addTabOfType($(this).data("value"))}),$(".addTab").on("click",function(){addTabWindow()}),$(".removeTab").on("click",function(){removeTabThis()}),$("#convertBtn").on("click",function(){converter()}),$("#consoleSel").on("change",function(){setConsoleMode($(this).val())}),$("#fileInputElement").on("change",function(e){uploadBin(e)}),$("#asmInputElement").on("change",function(e){uploadAsm(e)}),$(".loadAsm").on("click",function(){$("#asmInputElement").click()}),$(".loadBin").on("click",function(){$("#fileInputElement").click()}),$("#applyBtn").on("click",function(){var name=$("#filename").val();$("nav .selected span").html(name),tabs[currentTab].name=name;var memsize=$("#memsize").val();updateMemorySize(memsize);var isa=parseInt($("#isa").val());tabs[currentTab].instructionSet!=isa&&(tabs[currentTab].instructionSet=isa,delete tabs[currentTab].core,tabs[currentTab].core=createCore(isa,memsize,invokeEnvironmentCall,decodeCallback),switchModes(tabs[currentTab].core.aceStyle),setRegisterNames(),updateRegAndMemory())}),$("#sideGrabber").on("mousedown",function(e){var $element=$(this).parent(),$element2=$(this).parent().parent().find("section"),$element3=$(this).parent().parent().find("footer"),width=$(this).parent().parent().width();$(document).on("mouseup",function(e){$(document).off("mouseup").off("mousemove"),e.preventDefault()}),$(document).on("mousemove",function(me){var mx=100*me.pageX/width;mx=Math.min(90,Math.max(20,mx)),$element.css({width:100-mx+"%"}),$element2.css({width:mx+"%"}),$element3.css({width:mx+"%"}),me.preventDefault()}),e.preventDefault()}),$("#editorGrabber").on("mousedown",function(e){var $element=$(this).parent(),$element2=$(this).parent().parent().find("#editor"),width=$(this).parent().parent().width();$(document).on("mouseup",function(e){$(document).off("mouseup").off("mousemove"),e.preventDefault()}),$(document).on("mousemove",function(me){var mx=100*me.pageX/width;mx=Math.min(90,Math.max(20,mx)),$element.css({width:100-mx+"%"}),$element2.css({width:mx+"%"}),me.preventDefault()}),e.preventDefault()}),$("#yGrabber").on("mousedown",function(e){var $element=$(this).parent(),$element2=$(this).parent().parent().find("footer"),height=$(this).parent().parent().height(),pY=e.pageY-$(this).position().top+$element.position().top;$(document).on("mouseup",function(e){$(document).off("mouseup").off("mousemove"),e.preventDefault()}),$(document).on("mousemove",function(me){var my=100*(me.pageY-pY)/height;my=Math.min(90,Math.max(15,my)),$element.css({height:my+"%"}),$element2.css({height:100-my+"%"}),me.preventDefault()}),e.preventDefault()})}),$("#themes").change(function(){for(var themeID=$(this).val(),i=0;i<3;i++)$("#theme"+i).prop("disabled",i!=themeID);settings.theme=themeID,setSettingsCookie()}),$("#defaultISA").change(function(){var isa=$(this).val();settings.defaultISA=isa,setSettingsCookie()}),$("#editorSel").change(function(){setMachineCodeState(1==$(this).val())});var capturing=-1;function checkCode(e,str){var meta=-1!=str.indexOf("m"),alt=-1!=str.indexOf("a");return e.metaKey==meta&&e.altKey==alt}function hotkeyCapture(id){$(".hotkeyCapture:eq("+id+")").html("Detecting Hotkey..."),capturing=id}$(document).keydown(function(e){var evtobj=window.event?event:e,keystr=evtobj.which;if(17!=keystr&&18!=keystr&&16!=keystr)if(-1!=capturing){var writtenkey=getKeyNameFromStr(parseInt(keystr));switch(keystr="_"+keystr,evtobj.altKey&&(keystr="a"+keystr,writtenkey="Alt + "+writtenkey),evtobj.metaKey&&(keystr="m"+keystr,writtenkey="Mod + "+writtenkey),capturing){case 0:settings.hotkeyNewTab=keystr;break;case 1:settings.hotkeyOpen=keystr;break;case 2:settings.hotkeySave=keystr;break;case 3:settings.hotkeyAssemble=keystr;break;case 4:settings.hotkeySimulate=keystr;break;case 5:settings.hotkeyStepbystep=keystr}setSettingsCookie(),$(".hotkeyCapture:eq("+capturing+")").html(writtenkey),capturing=-1,evtobj.preventDefault(),evtobj.stopPropagation()}else{var found=!1,newKey=settings.hotkeyNewTab,newKeycode=parseInt(newKey.substr(newKey.indexOf("_")+1)),openKey=settings.hotkeyOpen,openKeyCode=parseInt(openKey.substr(openKey.indexOf("_")+1)),saveKey=settings.hotkeySave,saveKeyCode=parseInt(saveKey.substr(saveKey.indexOf("_")+1)),assembleKey=settings.hotkeyAssemble,assembleKeycode=parseInt(assembleKey.substr(assembleKey.indexOf("_")+1)),simulateKey=settings.hotkeySimulate,simulateKeyCode=parseInt(simulateKey.substr(simulateKey.indexOf("_")+1)),stepKey=settings.hotkeyStepbystep,stepKeyCode=parseInt(stepKey.substr(stepKey.indexOf("_")+1));switch(e.which){case newKeycode:checkCode(e,newKey)&&(addTabWindow(),found=!0);break;case openKeyCode:checkCode(e,openKey)&&($("#asmInputElement").click(),found=!0);break;case saveKeyCode:checkCode(e,saveKey)&&(downloadAsm(),found=!0);break;case assembleKeycode:checkCode(e,assembleKey)&&(uiAssemble(),found=!0);break;case simulateKeyCode:checkCode(e,simulateKey)&&(uiSimulate(),found=!0);break;case stepKeyCode:checkCode(e,stepKey)&&(uiStepbystep(),found=!0)}found&&e.preventDefault()}});
